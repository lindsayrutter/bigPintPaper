\documentclass[]{bmcart}
\setlength{\parskip}{10pt}
\usepackage[lined]{algorithm2e} %lined!
\begin{document}

\DontPrintSemicolon
\begin{algorithm}[H]
\SetInd{0.2em}{1.3em}

\KwData{Data frame input by user}
\KwResult{Interactive volcano plot}

/* \textit{Declare Shiny server}\;
\SetKwBlock{Fna}{\textnormal{server $\leftarrow$ function(input, output, session)\{ }}{}
\Fna{
\BlankLine
/* \textit{User input options}\;
observeEvent(input\$goButton, values\$x $\leftarrow$ values\$x $+$ 1)\;
observeEvent(input\$selPair, values\$x $\leftarrow$ 0)\;
observeEvent(input\$selMetric, values\$x $\leftarrow$ 0)\;
observeEvent(input\$selOrder, values\$x $\leftarrow$ 0)\;
observeEvent(input\$binSize, values\$x $\leftarrow$ 0)\;
observeEvent(input\$selPair, values\$selPair $\leftarrow$ input\$selPair)\;
\BlankLine
/* \textit{Define largest fold change dynamically based on data}\;
fcInMax $\leftarrow$ max(ldply(dataMetrics, rbind)[["logFC"]])
\BlankLine
/* \textit{Construct dynamic input Shiny slider for fold change}\;
output\$slider $\leftarrow$ renderUI({sliderInput("logFC", "Log fold change:", min=0, max=fcInMax, step=0.1)})
\BlankLine
/* \textit{Declare shiny output volcano plot}\;
\SetKwBlock{Fnb}{\textnormal{output\$volPlot $\leftarrow$ renderPlotly(\{ }}{}
\Fnb{
\BlankLine
/* \textit{Create reactive expression of plotly background volcano plot}\;
gP $\leftarrow$ reactive({p $\leftarrow$ ggplot(data); gP $\leftarrow$ ggplotly(p)})\;
\BlankLine
/* \textit{Create reactive expression of plotly background volcano plot}\;
plotlyVol $\leftarrow$ reactive(gP())\;
\BlankLine
/* \textit{Tailor interactivity of the plotly volcano plot object using custom JavaScript}\;
\SetKwBlock{Fnc}{\textnormal{plotlyVol() \%$>$\% onRender("function(el, x, data)\{ }}{}
\Fnc{
\BlankLine
/* \textit{Read handle called 'points' to obtain variables sent from R into JavaScript}\;
\SetKwBlock{Fnd}{\textnormal{Shiny.addCustomMessageHandler('points', function(drawPoints)\{ }}{}
\Fnd{
\BlankLine
/* \textit{Delete any old superimposed plotly geoms (dots)}\;
if (x.data.length $>$ 0)\{Plotly.deleteTraces(el.id)\}\;
\BlankLine
/* \textit{Create traces for selected gene IDs as points that state gene names upon hovering}\;
trace = \{x: drawPoints.geneX, y: drawPoints.geneY, mode: 'markers', color: drawPoints.pointColor, size: drawPoints.pointSize, text: drawPoints.geneID, hoverinfo: 'text'\}\;
\BlankLine
/* \textit{Superimpose traces onto the plotly volcano plot object}\;
Plotly.addTraces(el.id, trace)\;

}\})\; %Fnd
}\}")\; %Fnc
}\})\; %Fnb
\BlankLine
/* \textit{If the user changes the superimposed gene}\;
\SetKwBlock{Fob}{\textnormal{observe(\{ }}{}
\Fob{
\BlankLine
/* \textit{Save information about superimposed gene selected by user with a handle called 'points'. These values can then be sent from R to JavaScript}\;
session\$sendCustomMessage(type = "points", message=list(geneX=geneX, geneY=geneY, pointSize = pointSize, geneID=geneID, pointColor=pointColor))\;
}\})\; %Fob

\BlankLine
/* \textit{Declare Shiny output boxplot}\;
\SetKwBlock{Fne}{\textnormal{output\$boxPlot $\leftarrow$ renderPlotly(\{ }}{}
\Fne{

\BlankLine
/* \textit{Create reactive expression of plotly background boxplot}\;
BP $\leftarrow$ reactive(ggplot() $+$ geom\_boxplot())\;
ggBP $\leftarrow$ reactive(ggplotly(BP()))\;

\BlankLine
/* \textit{Tailor interactivity of the plotly boxplot object using custom JavaScript}\;
\SetKwBlock{Fnf}{\textnormal{ggBP() \%$>$\% onRender("function(el, x, data)\{ }}{}
\Fnf{
\BlankLine
/* \textit{Read handle called 'lines' to obtain variables sent from R into JavaScript}\;
\SetKwBlock{Fng}{\textnormal{Shiny.addCustomMessageHandler('lines', function(drawLines)\{ }}{}
\Fng{
\BlankLine
/* \textit{Delete any old superimposed plotly geoms (lines)}\;
Plotly.deleteTraces(el.id, traceLine)\;
\BlankLine
/* \textit{Create xArr and yArr, array of x and y values for superimposed lines, from drawLines}\;
\BlankLine
/* \textit{Create traces for selected gene IDs as lines that state gene names upon hovering}\;
traceLine = \{x: xArr, y: yArr, mode: 'lines', color: drawLines.pointColor, width: 2, opacity: 0.9; text: drawLines.geneID, hoverinfo: 'text'\}\;
\BlankLine
/* \textit{Superimpose traces onto the plotly volcano plot object}\;
Plotly.addTraces(el.id, traceLine)\;
}\})\; %Fng
}\})\; %Fnf
}\})\; %Fne

\BlankLine
/* \textit{If the user changes the superimposed gene}\;
\SetKwBlock{Fobs}{\textnormal{observe(\{ }}{}
\Fobs{
\BlankLine
/* \textit{Save information about superimposed gene selected by user with a handle called 'points'. These values can then be sent from R to JavaScript}\;
session\$sendCustomMessage(type = "lines", message=list(geneID=geneID, pointColor=pointColor))\;
}\})\; %Fob2

}\}\; %Fna
\caption{Pseudocode for interactive volcano plot}
\end{algorithm}
\end{document}
